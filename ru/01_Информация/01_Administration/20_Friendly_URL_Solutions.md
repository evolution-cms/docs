<ul>
  <li><a href="documentation/administration/friendly-url-solutions#commonedits">Общие настройки для файла .htaccess</a></li>
  <li><a href="documentation/administration/friendly-url-solutions#adminprotection">Защита админки</a></li>
  <li><a href="documentation/administration/friendly-url-solutions#sessionhandling">Управление сеансами</a></li>
  <li><a href="documentation/administration/friendly-url-solutions#cssjsdocuments">Файлы CSS и JS как документы Evo</a></li>
  <li><a href="documentation/administration/friendly-url-solutions#timezone">Часовой пояс</a></li>
  <li><a href="documentation/administration/friendly-url-solutions#defaultcharsets">Кодировки символов по умолчанию</a></li>
  <li><a href="documentation/administration/friendly-url-solutions#registerglobals">Директива register_globals</a></li>
  <li><a href="documentation/administration/friendly-url-solutions#solvingie">Разбираемся с причудами Internet Explorer</a></li>
</ul>
<h2>Настройка файла .htaccess для Evo для задействования возможностей модуля Apache mod_rewrite</h2>
<p>Evo поддерживает дружественные URL благодаря файлу .htaccess с определенными настройками. Чтобы использовать этот функционал, ваш сайт должен работать на сервере Apache с включенным модулем mod_rewrite, также, естественно, имя файла надо изменить с ht.access на .htaccess. Ниже приведен рекомендуемый шаблон для дополнительных настроек:</p>
<div><div id="highlighter_84127" class="syntaxhighlighter  php"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain">Options +FollowSymlinks</code></div><div class="line number2 index1 alt1"><code class="php plain">RewriteEngine On</code></div><div class="line number3 index2 alt2"><code class="php plain">RewriteBase /</code></div><div class="line number4 index3 alt1"><code class="php plain"># Fix Apache internal dummy connections from breaking [(site_url)] cache</code></div><div class="line number5 index4 alt2"><code class="php plain">RewriteCond %{HTTP_USER_AGENT} ^.*internal\ dummy\ connection.*$ [NC]</code></div><div class="line number6 index5 alt1"><code class="php plain">RewriteRule .* - [F,L]</code></div><div class="line number7 index6 alt2"><code class="php plain"># Rewrite domain.com -&gt; www.domain.com -- used with SEO Strict URLs plugin</code></div><div class="line number8 index7 alt1"><code class="php plain">#RewriteCond %{HTTP_HOST} .</code></div><div class="line number9 index8 alt2"><code class="php plain">#RewriteCond %{HTTP_HOST} !^www\.example\.com [NC]</code></div><div class="line number10 index9 alt1"><code class="php plain">#RewriteRule (.*) http:</code><code class="php comments">//www.example.com/$1 [R=301,L]</code></div><div class="line number11 index10 alt2"><code class="php plain"># Exclude /assets </code><code class="php keyword">and</code> <code class="php plain">/manager directories from rewrite rules</code></div><div class="line number12 index11 alt1"><code class="php plain">RewriteRule ^(manager|assets) - [L]</code></div><div class="line number13 index12 alt2"><code class="php plain"># For Friendly URLs</code></div><div class="line number14 index13 alt1"><code class="php plain">RewriteCond %{REQUEST_FILENAME} !-f</code></div><div class="line number15 index14 alt2"><code class="php plain">RewriteCond %{REQUEST_FILENAME} !-d</code></div><div class="line number16 index15 alt1"><code class="php plain">RewriteRule ^(.*)$ index.php?q=</code><code class="php variable">$1</code> <code class="php plain">[L,QSA]</code></div><div class="line number17 index16 alt2"><code class="php plain"># Reduce server overhead by enabling output compression </code><code class="php keyword">if</code> <code class="php plain">supported.</code></div><div class="line number18 index17 alt1"><code class="php plain">#php_flag zlib.output_compression On</code></div><div class="line number19 index18 alt2"><code class="php plain">#php_value zlib.output_compression_level 5</code></div></div></td></tr></tbody></table></div></div>
<div class="note">Если вы используете сервер IIS, дружественные URL вам все равно будут доступны, однако оптимальные решения требуют использования платных дополнительных модулей для IIS.</div>
<h3 id="commonedits">Общие настройки для файла .htaccess</h3>
<p>Прежде всего, директива RewriteBase должна указывать на папку, в которую установлена Evo. Например, если вы установили Evo в подпапку "evo", для этой директивы нужно указать значение "/evo":</p>
<div><div id="highlighter_447689" class="syntaxhighlighter  php"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain">RewriteBase /evo</code></div></div></td></tr></tbody></table></div></div>
<p>Обратите внимание, что в последнем блоке директив директивы сжатия gzip закомментированы, так как в некоторых средах они потенциально могут вызывать проблемы. Тем не менее, для того, чтобы веб-сервер работал быстрее, последние две строчки следует раскомментировать, как показано ниже:</p>
<div><div id="highlighter_617416" class="syntaxhighlighter  php"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain"># Reduce server overhead by enabling output compression </code><code class="php keyword">if</code> <code class="php plain">supported.</code></div><div class="line number2 index1 alt1"><code class="php plain">php_flag zlib.output_compression On</code></div><div class="line number3 index2 alt2"><code class="php plain">php_value zlib.output_compression_level 5</code></div></div></td></tr></tbody></table></div></div>
<p>Вам также может понадобиться сделать ваши URL нечувствительными к регистру, для этого следует добавить к директиве, находящейся в секции "For Friendly URLs" (это директивы для управления дружественными URL), директиву NC:</p>
<div><div id="highlighter_682636" class="syntaxhighlighter  php"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain">RewriteRule ^(.*)$ index.php?q=</code><code class="php variable">$1</code> <code class="php plain">[L,QSA,NC]</code></div></div></td></tr></tbody></table></div></div>
<p>Если вы предпочитаете, чтобы на вашем сайте к введенным URL-адресам всегда добавлялся префикс "www.", то есть чтобы ваши URL всегда показывались в виде "www.example.com", тогда нижеследующий раздел должен быть изменен таким образом:</p>
<div><div id="highlighter_530777" class="syntaxhighlighter  php"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain">RewriteCond %{HTTP_HOST} .</code></div><div class="line number2 index1 alt1"><code class="php plain">RewriteCond %{HTTP_HOST} !^www\.example\.com [NC]</code></div><div class="line number3 index2 alt2"><code class="php plain">RewriteRule (.*) http:</code><code class="php comments">//www.example.com/$1 [R=301,L]</code></div></div></td></tr></tbody></table></div></div>
<p>Если вы не используете виртуальные домены и работаете на локальном компьютере, или вы ждете обновление DNS, то есть если для доступа к вашему сайту вы используете URL вида "http://10.0.0.1/~myacct", правило перезаписи URL следует переписать, как показано ниже. При этом, когда вы перейдете на удаленный сервер, не забудьте восстановить все, как было.</p>
<div><div id="highlighter_554723" class="syntaxhighlighter  php"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain">RewriteCond %{REQUEST_FILENAME} !-f</code></div><div class="line number2 index1 alt1"><code class="php plain">RewriteCond %{REQUEST_FILENAME} !-d</code></div><div class="line number3 index2 alt2"><code class="php plain">RewriteRule ^(.*)$ /~myacct/index.php?q=</code><code class="php variable">$1</code> <code class="php plain">[L,QSA]</code></div></div></td></tr></tbody></table></div></div>
<h3 id="adminprotection">Защита админки</h3>
<p>Если вы хотите ограничить доступ к админке только конкретным IP-адресом, но при этом вам нужно разрешить доступ к компонентам, относящимся к открытой части сайта, например, к капче, используйте следующие директивы. Эти директивы должны быть помещены в файл .htaccess, находящийся в папке админки:</p>
<div><div id="highlighter_16115" class="syntaxhighlighter  php"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain"># Разрешаем доступ к админке только с конкретных IP-адресов</code></div><div class="line number2 index1 alt1"><code class="php plain">Options +FollowSymlinks</code></div><div class="line number3 index2 alt2"><code class="php plain">RewriteEngine On</code></div><div class="line number4 index3 alt1"><code class="php plain"># Блокировка по IP. Для IP-адресов, указанных в списке, доступ будет открыт.</code></div><div class="line number5 index4 alt2"><code class="php plain">RewriteCond %{REMOTE_ADDR} !^(192\.168\.0\.128)$</code></div><div class="line number6 index5 alt1"><code class="php plain">RewriteCond %{REQUEST_FILENAME} !/includes/veriword\.php$</code></div><div class="line number7 index6 alt2"><code class="php plain">RewriteRule ^(.*)$ index.php?q=</code><code class="php variable">$1</code> <code class="php plain">[L,QSA]</code></div></div></td></tr></tbody></table></div></div>
<div class="note">Первую строчку ("Options +FollowSymlinks") может понадобиться закомментировать в некоторых ситуациях, где подобная строчка уже присутствует в корневой папке сайта, чтобы избежать ошибок сервера.</div>
<h3 id="sessionhandling">Управление сеансами</h3>
<p>Если ваш сайт работает в среде, в которой имеют место проблемы, связанные с агрессивной сборкой мусора, о чем могут свидетельствовать неожиданные и частые выходы из админки, то можно настроить местонахождение для файлов сеансов, чтобы убрать их из глобальной и разделяемой папки tmp/session, где они находятся по умолчанию:</p>
<div class="note">Если вы добавили эти директивы в ваш файл .htaccess, их также надо добавить в файл .htaccess, находящийся в папке админки.</div>
<div><div id="highlighter_468341" class="syntaxhighlighter  php"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain">php_value session.save_path /path/to/your/web/content/sessions/</code></div><div class="line number2 index1 alt1"><code class="php plain">php_value session.gc_maxlifetime 28800</code></div></div></td></tr></tbody></table></div></div>
<h3 id="cssjsdocuments">Файлы CSS и JS как документы Evo</h3>
<p>По умолчанию файл .htaccess для Evo настроен так, что он исключает из области действия правил перезаписи URL папку /assets и папку админки. Если у вас есть документ Evo, используемый как файл CSS, вам надо будет изменить одну строчку, чтобы разрешить перезапись URL в папке /assets, если ваш файл CSS находится именно там.</p>
<div><div id="highlighter_136193" class="syntaxhighlighter  php"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain">RewriteRule ^(manager|assets) - [L]</code></div></div></td></tr></tbody></table></div></div>
<p>Это следует изменить так</p>
<div><div id="highlighter_532608" class="syntaxhighlighter  php"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain">RewriteRule ^manager - [L]</code></div></div></td></tr></tbody></table></div></div>
<div class="note"><strong>Подсказка</strong><br>
<p>Если вам все-таки нужно сохранить некоторые подпапки как исключения, то правила перезаписи можно отключить, например, в папках /assets/images и /assets/snippets с помощью следующей директивы:</p>
  <div><div id="highlighter_110968" class="syntaxhighlighter  php"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain">RewriteRule ^(manager|assets/images|assets/snippets) - [L]</code></div></div></td></tr></tbody></table></div></div>
</div>
<h3 id="timezone">Часовой пояс</h3>
<p>На некоторых серверах могут быть не настроены часовые пояса, что может вызывать проблемы. Можно попробовать настроить часовой пояс следующим образом (полный список поддерживаемых часовых поясов находится <a target="_blank" rel="nofollow" href="//php.net/manual/en/timezones.php">здесь</a>).</p>
<div><div id="highlighter_982415" class="syntaxhighlighter  php"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain">php_value </code><code class="php functions">date</code><code class="php plain">.timezone Europe/Moscow</code></div></div></td></tr></tbody></table></div></div>
<p>или</p>
<div><div id="highlighter_792991" class="syntaxhighlighter  php"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain">SetEnv TZ America/Chicago</code></div></div></td></tr></tbody></table></div></div>
<h3 id="defaultcharsets">Кодировки символов по умолчанию</h3>
<p>В принципе, чтобы корректно обрабатывать символьные кодировки, вам нужно соответствующим образом исправить ваш код и базу данных. Однако если вам очень хочется, то вы можете прочитать справку о директиве <a target="_blank" rel="nofollow" href="//httpd.apache.org/docs/2.0/mod/core.html#adddefaultcharset">AddDefaultCharset</a> и подумать об использовании этой директивы в следующем виде:</p>
<div><div id="highlighter_802383" class="syntaxhighlighter  php"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain">AddDefaultCharset utf-8</code></div></div></td></tr></tbody></table></div></div>
<h3 id="registerglobals">Директива register_globals</h3>
<div class="warning"><strong>Предупреждение</strong><br>
<p>Если у вашего сервера включена директива register_globals (и отключить ее невозможно), бегите отсюда на новый хостинг как можно быстрее. Да-да, серьезно.</p>
<p><strong>Начиная с Evo версии 1.2.1, директива register_globals на вашем сервере должна быть отключена, иначе Evo не будет работать.</strong></p>
</div>
<p>Если директива register_globals включена, то ваш сайт практически со стопроцентной вероятностью рано или поздно будет взломан, а если он находится на разделяемом хостинге, так тем более. Это все равно, что дать маленькому ребенку поиграться с заряженным пистолетом и надеяться, что он не нажмет на курок. Если вы платите за хостинг меньше 15 долларов в месяц, значит, ваш хостинг разделяемый. Подробнее о директиве register_globals см. <a target="_blank" rel="nofollow" href="//php.net/register_globals">здесь</a>.</p>
<p>Чтобы проверить, что эта директива отключена, откройте админку, затем войдите в меню "Система" и выберите пункт "Системная информация", затем в открывшейся странице выберите ссылку phpinfo(). На странице, открывшейся по этой ссылке, найдите информацию о директиве register_globals. Ее локальное значение должно быть OFF. Если же ее основное значение равно OFF, то беспокоиться по поводу этой директивы вам не нужно.</p>
<p><strong>Если директива register_globals вызывает ошибку сервера 500:</strong></p>
<p>Это означает, что ваш сервер запрещает устанавливать директивы PHP в файле .htaccess. В этом случае соответствующее изменение надо внести напрямую в файл php.ini. Если вы используете платный хостинг, свяжитесь с его техподдержкой, чтобы они это сделали. Надо сказать, что не все серверы позволяют использовать локальные файлы php.ini, к тому же, они должны содержать все настройки PHP (а не только эту), иначе все неуказанные директивы PHP будут установлены в значения по умолчанию. Подробнее об установке директив PHP см. на сайте www.php.net.</p>
<div><div id="highlighter_185869" class="syntaxhighlighter  php"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain"># Отключаем register_globals, так как у нас корявый хостинг, не заботящийся о безопасности</code></div><div class="line number2 index1 alt1"><code class="php plain">php_flag register_globals Off</code></div></div></td></tr></tbody></table></div></div>
<h3 id="solvingie">Разбираемся с причудами Internet Explorer</h3>
<p>Если на вашем сайте используются файлы .htc, то некоторые серверы могут их отдавать с неправильным MIME-типом. Чтобы решить эту проблему, можно добавить следующую строчку. Это критически важно для пользователей MS Windows XP SP2:</p>
<div><div id="highlighter_11284" class="syntaxhighlighter  php"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain"># Настраиваем MIME-тип для файлов .htc</code><code class="php keyword">для</code> <code class="php plain">Internet Explorer</code></div><div class="line number2 index1 alt1"><code class="php plain">AddType text/x-component .htc</code></div></div></td></tr></tbody></table></div></div>
<p>Следующие директивы позволяют ликвидировать мерцание экрана при использовании IE в случае наложения разных файлов CSS. После того, как вы их введете, вам может понадобиться принудительная перезагрузка страницы, чтобы увидеть изменения.</p>
<div><div id="highlighter_926771" class="syntaxhighlighter  php"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain"># Исправляем мерцание экрана</code><code class="php keyword">для</code> <code class="php plain">Internet Explorer</code></div><div class="line number2 index1 alt1"><code class="php plain">ExpiresActive On</code></div><div class="line number3 index2 alt2"><code class="php plain">ExpiresByType image/gif A2592000</code></div><div class="line number4 index3 alt1"><code class="php plain">ExpiresByType image/jpeg A2592000</code></div><div class="line number5 index4 alt2"><code class="php plain">ExpiresByType image/png A2592000</code></div><div class="line number6 index5 alt1"><code class="php plain">BrowserMatch </code><code class="php string">"MSIE"</code> <code class="php plain">brokenvary=1</code></div><div class="line number7 index6 alt2"><code class="php plain">BrowserMatch </code><code class="php string">"Mozilla/4.[0-9]{2}"</code> <code class="php plain">brokenvary=1</code></div><div class="line number8 index7 alt1"><code class="php plain">BrowserMatch </code><code class="php string">"Opera"</code> <code class="php plain">!brokenvary</code></div><div class="line number9 index8 alt2"><code class="php plain">SetEnvIf brokenvary 1 force-no-vary</code></div></div></td></tr></tbody></table></div></div>
<div class="note">Файлы .htaccess дают возможность настраивать конфигурацию сервера на уровне отдельной папки, если у вас нет доступа к главному конфигурационному файлу сервера Apache httpd.conf. Вообще-то, при любой возможности для директив сервера следует использовать главный конфигурационный файл, так как использование файлов .htaccess приводит к увеличению времени обработки страниц сайта.</div>
